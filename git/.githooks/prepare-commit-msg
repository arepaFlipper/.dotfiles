#!/usr/bin/env bash
set -euo pipefail

MSG_FILE="$1"
COMMIT_SOURCE="${2:-}"

# Skip for merge or squash commits
if [[ "$COMMIT_SOURCE" == "merge" || "$COMMIT_SOURCE" == "squash" ]]; then
  exit 0
fi

# Full emoji list (all in one array)
EMOJIS=(
  😀 😃 😄 😁 😆 😅 😂 🤣 🥲 😊 😇 🙂 🙃 😉 😌
  😍 🥰 😘 😗 😙 😚 😋 😛 😝 😜 🤪 🤨 🧐 🤓 😎
  🥸 🤩 🥳 😏 😒 😞 😔 😟 😕 🙁 ☹️ 😣 😖 😫 😩
  🥺 😢 😭 😤 😠 😡 🤬 🤯 😳 🥵 🥶 😱 😨 😰 😥
  😓 🤗 🤔 🤭 🤫 🤥 😶 😐 😑 😬 🙄 😯 😦 😧 😮
  😲 🥱 😴 🤤 😪 😵 🤐 🥴 🤢 🤮 🤧 😷 🤒 🤕 🤑
  🤠 😈 👿 👹 👺 🤡 💩 👻 💀 ☠️ 👽 👾 🤖 🎃 😺
  😸 😹 😻 😼 😽 🙀 😿 😾
	😊  😎  🚀  💯  🔢  😀  😃 
	😄  😁  😆  😆  😅  😂  🙃 
	😉  😊  😇  😍  😘  😗  ☺️ 
	😚  😙  😋  😟  ☹️  😮  😯 
	😲  😳  😦  😧  😨  😰  😥 
	😢  😭  😱  😖  😣  😞  😓 
	😩  😫  😤  😡  😠  😈  👿 
	💀  ☠️  👹  👺  👻  👽  👾 
	🤖  😺  😸  😹  😻  😼  😽 
	🙀  😿  😾  🙈  🙉  🙊  💋 
	💌  💟  ❣️  💔  ❤️  💛  💚 
	💙  💜  💢  💥  💥  💫  💦 
	💨  🕳️  💣  💬  👍  👍  👎 
	✊  👊  👏  🙌  👐  🙏  💅 
	💪  👂  👃  🫀  🫁  👀  👁️ 
	👅  👄  👶  🐮  🐂  🐃  🐄 
	🐷  🐖  🐗  🐽  🐏  🐑  🐐 
	🐫  🐘  🐭  🐁  🐀  🐹  🐰 
	🐇  🐿️  🐾  🐔  🐓  🐣  🐤 
	🐥  🐦  🐧  🕊️  🪶  🐸  🐊 
	🐢  🐍  🐲  🐉  🦖  🐳  🐋 
	🐬  🐬  🐟  🐠  🐡  🐙  🐚 
	🐌  🐛  💐  🌸  💮  🏵️  🌹 
	🌺  🌻  🌼  🌷  🌱  🪴  🌲 
	🌳  🌴  🌵  🌾  🌿  ☘️  🍀 
	🍁  🍂  🍃  🍇  🍈  🍉  🍊 
	🍊  🍊  🍋  🍌  🍍  🍎  🍏 
	🍐  🍑  🍒  🍓  🫐  🍅  🫒 
	🌽  🌶️  🫑  🍄  🌰  🍞  🫓 
	🍖  🍗  🥩  🥓  🍔  🍟  🍕 
	🍳  🥘  🍲  🫕  🍱  🍘  🍙 
	🍚  🍛  🍜  🍝  🍠  🍢  🍣 
	🍤  🍥  🍡  🍦  🍧  🍨  🍩 
	🍪  🎂  🍰  🍫  🍬  🍭  🍮 
	🍯  🍼  ☕  🫖  🍵  🍶  🍷 
	🍸  🍹  🍺  🍻  🍽️  🍴  🔪 
	🛖  🏘️  🏚️  🏠  🏡  🏢  🏣 
	🏤  🏥  🏦  🏨  🏩  🏪  🏫 
	🏬  🏭  🏯  🏰  💒  🗼  🗽 
	⛪  🕌  🛕  ⛩️  ⛲  ⛺  🌁 
	🌃  🏙️  🌄  🌅  🌆  🌇  🌉 
	♨️  🎠  🎡  🎢  💈  🎪  🚂 
	🚃  🚄  🚅  🚆  🚇  🚈  🚉 
	🚊  🚝  🚞  🚋  🚌  🚍  🚎 
	🚐  🚑  🚒  🚓  🚔  🚕  🚖 
	🚗  🚗  🚘  🚙  🚁  🚟  🚠 
	🚡  🛰️  🚀  🛸  🛎️  🧳  ⌛ 
	⏳  ⌚  ⏰  ⏱️  ⏲️  🕰️  🌒 
	🌓  🌔  🌔  🌕  🌖  🌗  🌘 
	🌙  🌚  🌛  🌜  🌡️  ☀️  🌝 
	🌞  🪐  ⭐  🌟  🌠  🌌  ☁️ 
	⛅  ⛈️  🌤️  🌥️  🌦️  🌧️  🌨️ 
	🌩️  🌪️  🌫️  🌬️  🌀  🌈  🌂 
	☂️  ☔  ⛱️  ⚡  ❄️  ☃️  ⛄ 
	☄️  🔥  💧  🌊  🎃  🎄  🎆 
	🎇  🧨  ✨  🎈  🎉  🎊  🎋 
	🎍  🎎  🎏  🎐  🎑  🧧  🎀 
	🎁  🎗️  🎟️  🎫  🎖️  🏆  ⚽ 
	⚾  🏀  🏈  🏉  🎾  🎳  ⛳ 
	⛸️  🎣  🎽  🎿  🛷  🎯  🪀 
	🪁  🎱  🔮  🪄  🎮  🃏  🀄 
	🎴  🎭  🖼️  🎨  🪡  🧶  🪢 
	👓  🕶️  🩲  🩳  👙  👚  👛 
	👜  👝  🛍️  🎒  🩴  👞  👞 
	👟  💍  💎  🔇  🔈  🔉  🔊 
	📢  📣  📯  🔔  🔕  🎼  🎵 
	🎶  🎙️  🎚️  🎛️  🎤  🎧  📻 
	🎷  🪗  🎸  🎹  🎺  🎻  🪕 
	🥁  🪘  📱  📲  ☎️  ☎️  📞 
	📟  📠  🔋  🔌  💻  🖥️  🖨️ 
	⌨️  🖱️  🖲️  💽  💾  💿  📀 
	🧮  🎥  🎞️  📽️  🎬  📺  📷 
	📸  📹  📼  🔍  🔎  🕯️  💡 
	🔦  🏮  🪔  📔  📕  📖  📖 
	📗  📘  📙  📚  📓  📒  📃 
	📜  📄  📰  🗞️  📑  🔖  🏷️ 
	💰  🪙  💴  💵  💶  💷  💸 
	💳  🧾  💹  ✉️  📧  📧  📨 
	📩  📤  📥  📦  📫  📪  📬 
	📭  📮  🗳️  ✏️  ✒️  🖋️  🖊️ 
	🖌️  🖍️  📝  📝  💼  📁  📂 
	🗂️  📅  📆  🗒️  🗓️  📇  📈 
	📉  📊  📋  📌  📍  📎  🖇️ 
	📏  📐  ✂️  🗃️  🗄️  🗑️  🔒 
	🔓  🔏  🔐  🔑  🗝️  🔨  🪓 
	⛏️  ⚒️  🛠️  🗡️  ⚔️  🔫  🪃 
	🏹  🛡️  🪚  🔧  🪛  🔩  ⚙️ 
	🗜️  ⚖️  🦯  🔗  ⛓️  🪝  🧰 
	🧲  🪜  ⚗️  🧪  🧫  🧬  🔬 
	🔭  📡  💉  🩸  💊  🩹  🩺 
	🚪  🛗  🪞  🪟  🛏️  🛋️  🪑 
	🚽  🪠  🚿  🛁  🪤  🪒  🧴 
	🗿  🪧  🏧  🚮  🚰  ♿  🚹 
	🚺  🚻  🚼  🚾  🛂  🛃  🛄 
	🛅  🚸  ⛔  🚫  🚳  🚭  🚯 
	🚱  🚷  📵  🔞  ☢️  ☣️  🔄 
	🔙  🔚  🔛  🔜  🔝  🛐  ✡️ 
	☸️  ☯️  ☪️  ☮️  🕎  🔯  ♈ 
	♉  ♊  ♋  ♌  ♍  ♎  ♏ 
	♐  ♑  ♒  ♓  ⛎  🔀  🔁 
	🔂  ⏩  ⏭️  ⏯️  ⏪  ⏮️  🔼 
	⏫  🔽  ⏬  ⏸️  ⏹️  ⏺️  ⏏️ 
	🎦  🔅  🔆  📶  📳  📴  ♀️ 
	♂️  ⚧️  ✖️  ➕  ➖  ➗  ♾️ 
	💱  💲  ⚕️  ♻️  ⚜️  🔱  📛 
	🔰  ⭕  ✅  ☑️  ✔️  ❌  ❎ 
	〽️  ✳️  ✴️  🆒  🆓  ℹ️  🆔 
	Ⓜ️  🆕  🆖  🅾️  🆗  🅿️  🆘 
	🆙  🆚  🔴  🟠  🟡  🟢  🔵 
	🟣  🟤  ⚫  ⚪  🟥  🟧  🟨 
	🟩  🟦  🟪  🟫  ⬛  ⬜  ◼️ 
	◻️  ◾  ◽  ▪️  🔶  🔷  🔸 
	🔹  🔺  🔻  😀  😃  😄  😁 
	😆  😅  🤣  😂  🙂  🙃  🫠 
	😉  😊  😇  🥰  😍  🤩  😘 
	😗  ☺️  😚  😙  🥲  😋  😛 
	😜  🤪  😝  🤑  🤗  🤭  🫢 
	🫣  🤫  🤔  🫡  🤐  🤨  😐 
	😑  😶  🫥  😶  🌫️  😏  😒 
	🙄  😬  😮  💨  🤥  😌  😔 
	😪  🤤  😴  😷  🤒  🤕  🤢 
	🤮  🤧  🥵  🥶  🥴  😵  😵 
	💫  🤯  🤠  🥳  🥸  😎  🤓 
	🧐  😕  🫤  😟  🙁  ☹️  😮 
	😯  😲  😳  🥺  🥹  😦  😧 
	😨  😰  😥  😢  😭  😱  😖 
	😣  😞  😓  😩  😫  🥱  😤 
	😡  😠  🤬  😈  👿  💀  ☠️ 
	💩  🤡  👹  👺  👻  👽  👾 
	🤖  😺  😸  😹  😻  😼  😽 
	🙀  😿  😾  🙈  🙉  🙊  💋 
	💌  💘  💝  💖  💗  💓  💞 
	💕  💟  ❣️  💔  ❤️  🔥  ❤️ 
	🩹  ❤️  🧡  💛  💚  💙  💜 
	🤎  🖤  🤍  💯  💢  💥  💫 
	💦  💨  🕳️  💣  💬  👁️  🗨️ 
	🗨️  🗯️  💭  💤  👋  🤚  🖐️ 
	✋  🖖  🫱  🫲  🫳  🫴  👌 
	🤌  🤏  ✌️  🤞  🫰  🤟  🤘 
	🤙  👈  👉  👆  🖕  👇  ☝️ 
	🫵  👍  👎  ✊  👊  🤛  🤜 
	👏  🙌  🫶  👐  🤲  🤝  🙏 
	💅  🤳  💪  🦾  🦿  🦵  🦶 
	👂  🦻  👃  🧠  🫀  🫁  🦷 
	🦴  👀  👁️  👅  👄  🫦  👶 
	👴  👵  🙍  🧑  🔧  👨  🔧 
	👩  🔧  🏭  🏭  🏭  💼  💼 
	💼  🔬  🔬  🔬  💻  💻  💻 
	🎤  🎤  🎤  🎨  🎨  🎨  ✈️ 
	✈️  ✈️  🚀  🚀  🚀  🚒  🚒 
	🚒  👮  🥷  👷  👷  🤴  👳 
	👲  🧕  🤵  🤵  ♀️  🤰  🫃 
	🫄  🤱  🍼  👼  🎅  🤶  🎄 
	🦸  🦹  🧙  🧚  🧛  🧜  🕺 
	🕴️  👯  👯  🛀  🛌  🤝  ❤️ 
	💋  ❤️  💋  ❤️  💋  ❤️  ❤️ 
	❤️  👪  🗣️  👤  🫂  👣  🦲 
	🐵  🐒  🦍  🦧  🐶  🐕  🦮 
	🐕  🦺  🐩  🐺  🦊  🦝  🐱 
	🐈  🐈  ⬛  🦁  🐯  🐅  🐆 
	🐴  🐎  🦄  🦓  🦌  🦬  🐮 
	🐂  🐃  🐄  🐷  🐖  🐗  🐽 
	🐏  🐑  🐐  🐪  🐫  🦙  🦒 
	🐘  🦣  🦏  🦛  🐭  🐁  🐀 
	🐹  🐰  🐇  🐿️  🦫  🦔  🦇 
	🐻  🐻  ❄️  🐨  🐼  🦥  🦦 
	🦨  🦘  🦡  🐾  🦃  🐔  🐓 
	🐣  🐤  🐥  🐦  🐧  🕊️  🦅 
	🦆  🦢  🦉  🦤  🪶  🦩  🦚 
	🦜  🐸  🐊  🐢  🦎  🐍  🐲 
	🐉  🦕  🦖  🐳  🐋  🐬  🦭 
	🐟  🐠  🐡  🦈  🐙  🐚  🪸 
	🐌  🦋  🐛  🐜  🐝  🪲  🐞 
	🦗  🪳  🕷️  🕸️  🦂  🦟  🪰 
	🪱  🦠  💐  🌸  💮  🪷  🏵️ 
	🌹  🥀  🌺  🌻  🌼  🌷  🌱 
	🪴  🌲  🌳  🌴  🌵  🌾  🌿 
	☘️  🍀  🍁  🍂  🍃  🪹  🪺 
	🍇  🍈  🍉  🍊  🍋  🍌  🍍 
	🥭  🍎  🍏  🍐  🍑  🍒  🍓 
	🫐  🥝  🍅  🫒  🥥  🥑  🥔 
	🥕  🌽  🌶️  🫑  🥒  🥬  🥦 
	🧄  🧅  🍄  🥜  🫘  🌰  🍞 
	🥐  🥖  🫓  🥨  🥯  🥞  🧇 
	🧀  🍖  🍗  🥩  🥓  🍔  🍟 
	🍕  🌭  🥪  🌮  🌯  🫔  🥙 
	🧆  🥚  🍳  🥘  🍲  🫕  🥣 
	🥗  🍿  🧈  🧂  🥫  🍱  🍘 
	🍙  🍚  🍛  🍜  🍝  🍠  🍢 
	🍣  🍤  🍥  🥮  🍡  🥟  🥠 
	🥡  🦀  🦞  🦐  🦑  🦪  🍦 
	🍧  🍨  🍩  🍪  🎂  🍰  🧁 
	🥧  🍫  🍬  🍭  🍮  🍯  🍼 
	🥛  ☕  🫖  🍵  🍶  🍾  🍷 
	🍸  🍹  🍺  🍻  🥂  🥃  🫗 
	🥤  🧋  🧃  🧉  🧊  🥢  🍽️ 
	🍴  🥄  🔪  🫙  🏺  🌍  🌎 
	🌏  🌐  🗺️  🗾  🧭  🏔️  ⛰️ 
	🌋  🗻  🏕️  🏖️  🏜️  🏝️  🏞️ 
	🏟️  🏛️  🏗️  🧱  🪨  🪵  🛖 
	🏘️  🏚️  🏠  🏡  🏢  🏣  🏤 
	🏥  🏦  🏨  🏩  🏪  🏫  🏬 
	🏭  🏯  🏰  💒  🗼  🗽  ⛪ 
	🕌  🛕  🕍  ⛩️  🕋  ⛲  ⛺ 
	🌁  🌃  🏙️  🌄  🌅  🌆  🌇 
	🌉  ♨️  🎠  🛝  🎡  🎢  💈 
	🎪  🚂  🚃  🚄  🚅  🚆  🚇 
	🚈  🚉  🚊  🚝  🚞  🚋  🚌 
	🚍  🚎  🚐  🚑  🚒  🚓  🚔 
	🚕  🚖  🚗  🚘  🚙  🛻  🚚 
	🚛  🚜  🏎️  🏍️  🛵  🦽  🦼 
	🛺  🚲  🛴  🛹  🛼  🚏  🛣️ 
	🛤️  🛢️  ⛽  🛞  🚨  🚥  🚦 
	🛑  🚧  ⚓  🛟  ⛵  🛶  🚤 
	🛳️  ⛴️  🛥️  🚢  ✈️  🛩️  🛫 
	🛬  🪂  💺  🚁  🚟  🚠  🚡 
	🛰️  🚀  🛸  🌒  🌓  🌔  🌕 
	🌖  🌗  🌘  🌙  🌚  🌛  🌜 
	🌡️  ☀️  🌝  🌞  🪐  ⭐  🌟 
	🌠  🌌  ☁️  ⛅  ⛈️  🌤️  🌥️ 
	🌦️  🌧️  🌨️  🌩️  🌪️  🌫️  🌬️ 
	🌀  🌈  🌂  ☂️  ☔  ⛱️  ⚡ 
	❄️  ☃️  ⛄  ☄️  🔥  💧  🌊 
	🎃  🎄  🎆  🎇  🧨  ✨  🎈 
	🎉  🎊  🎋  🎍  🎎  🎏  🎐 
	🎑  🧧  🎀  🎁  🎗️  🎟️  🎫 
	🎖️  🏆  🏅  🥇  🥈  🥉  ⚽ 
	⚾  🥎  🏀  🏐  🏈  🏉  🎾 
	🥏  🎳  🏏  🏑  🏒  🥍  🏓 
	🏸  🥊  🥋  🥅  ⛳  ⛸️  🎣 
	🤿  🎽  🎿  🛷  🥌  🎯  🪀 
	🪁  🎱  🔮  🪄  🧿  🪬  🎮 
	🕹️  🎰  🎲  🧩  🧸  🪅  🪩 
	🪆  ♠️  ♥️  ♦️  ♣️  ♟️  🃏 
	🀄  🎴  🎭  🖼️  🎨  🧵  🪡 
	🧶  🪢  👓  🕶️  🥽  🥼  🦺 
	👔  👕  👖  🧣  🧤  🧥  🧦 
	👗   👘   🥻   🩱   🩲   🩳   👙  
	👚   👛   👜   👝   🛍️   🎒  🩴 
	👞   👟   🥾   🥿   👠   👡   🩰  
	👢   👑   👒   🎩   🎓   🧢   🪖  
	⛑️   📿   💄   💍   💎   🔇   🔈  
	🔉  🔊  📢   📣   📯   🔔   🔕  
	🎼   🎵   🎶   🎙️   🎚️   🎛️   🎤  
	🎧   📻   🎷   🪗   🎸   🎹   🎺  
	🎻   🪕   🥁  🪘  📱   📲   ☎️  
	📞   📟   📠   🔋   🪫   🔌   💻  
	🖥️   🖨️   ⌨️   🖱️   🖲️   💽   💾  
	💿   📀   🧮   🎥   🎞️   🛎️  🧳 
	⌛  ⏳  ⌚  ⏰  ⏱️  ⏲️  🕰️ 
	📽️  🎬  📺   📷   📸   📹   📼  
	🔍   🔎   🕯️   💡   🔦   🏮   🪔  
	📔   📕   📖   📗   📘   📙  📚 
	📓   📒   📃   📜   📄   📰   🗞️  
	📑   🔖   🏷️   💰   🪙   💴   💵  
	💶   💷   💸   💳  🧾  💹   ✉️  
	📧   📨   📩   📤   📥   📦   📫  
	📪   📬   📭   📮   🗳️   ✏️   ✒️  
	🖋️   🖊️   🖌️  🖍️  📝   💼   📁  
	📂   🗂️   📅   📆   🗒️   🗓️   📇  
	📈   📉   📊   📋   📌   📍   📎  
	🖇️   📏  📐  ✂️   🗃️  🗄️   🗑️  
	🔒   🔓   🔏   🔐   🔑   🗝️   🔨  
	🪓   ⛏️   ⚒️   🛠️   🗡️   ⚔️   🔫  
	🪃   🏹  🛡️  🪚   🔧  🪛   🔩  
	⚙️   🗜️   ⚖️   🦯   🔗   ⛓️   🪝  
	🧰   🧲   🪜   ⚗️   🧪   🧫   🧬  
	🔬   🔭  📡  💉   🩸  💊   🩹  
	🩼   🩺   🩻   🚪   🛗   🪞   🪟  
	🛏️   🛋️   🪑   🚽   🪠   🚿   🛁  
	🪤   🪒  🧴  🧷   🧹   🧺   🧻  
	🪣   🧼   🫧   🪥   🧽   🧯   🛒  
	🚬   ⚰️   🪦   ⚱️   🗿   🪧   🪪  
)

# Pick random emoji
RAND_EMOJI="${EMOJIS[RANDOM % ${#EMOJIS[@]}]}"

# Prepend to commit message
# If commit message is empty, just write emoji
if [ ! -s "$MSG_FILE" ]; then
  printf "%s\n\n" "$RAND_EMOJI" > "$MSG_FILE"
else
  sed -i.bak "1s/^/${RAND_EMOJI} /" "$MSG_FILE"
fi

